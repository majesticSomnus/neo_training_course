

### homework 4

1. 描述节点之间的握手协议



1. 首先 neo 节点会与种子节点连接。

2. 节点连接成功后，首先会发送 version 消息，并等待接收 version 消息

3. 然后会发送 verack 消息，并等待接收 verack 消息.
4. 向对方节点发送inv消息，询问对点是否有最新的广播消息
5. 如果自己的区块头高度小于对方的区块高度，则向对方发送 getheaders 消息。

6. 对方收到 getheaders 消息后，通过 headers 消息应答发送不超过2000个区块头。

7. 如果区块头已经同步完成，而区块高度低于对方，则向对方发送 getblocks 消息。

8. 节点有义务将收到的共识信息、区块、交易这些信息通过 inv 消息转发给其它节点。




2. 对比以太坊的Gossip协议的优劣

优：NEO节点间在数据传输中对于共识信息、区块、交易这些较大的数据，通过哈希值管理来避免同时从不同节点获取多分重复的数据，降低网络负担。

劣：Gossip协议是最终一致性协议，其中包含Anti-Entropy类型协议，以固定的概率传播所有的数据，每个节点周期性地随机选择其他节点，然后通过互相交换自己的**所有**数据来消除两者之间的差异，最终达成一致性。而NEO无此类型，若因某些原因节点丢失某一同步过的区块数据，后续无法达成最终一致。